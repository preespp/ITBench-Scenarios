---
metadata:
  version: "v1"
fault:
  - entity:
      name: valkey-cart-pod
      group_id: valkey-pod-1
      kind: Pod
    condition: Storage filled to 90% capacity by sidecar container writing dummy data
    category: Resource
    fault_mechanism: custom
alerts:
  - id: RequestErrorRate
    group_id: cart-service-1
    metadata:
      description: Request error rate in service cart in namespace otel-demo is above 0
  - id: RequestLatency
    group_id: cart-service-1
    metadata:
      description: Latency in service cart in namespace otel-demo is above 1500ms
  - id: RequestErrorRate
    group_id: checkout-service-1
    metadata:
      description: Request error rate in service checkout in namespace otel-demo is above 0
  - id: RequestErrorRate
    group_id: frontend-service-1
    metadata:
      description: Request error rate in service frontend in namespace otel-demo is above 0
  - id: RequestErrorRate
    group_id: frontend-proxy-service-1
    metadata:
      description: Request error rate in service frontend-proxy in namespace otel-demo is above 0
groups:
  - id: valkey-pod-1
    kind: Pod
    filter:
      - valkey-cart-.*
    namespace: otel-demo
    root_cause: true
  - id: valkey-service-1
    kind: Service
    filter:
      - valkey-cart\b
    namespace: otel-demo
  - id: cart-service-1
    kind: Service
    filter:
      - cart\b
    namespace: otel-demo
  - id: cart-pod-1
    kind: Pod
    filter:
      - cart-.*
    namespace: otel-demo
  - id: checkout-service-1
    kind: Service
    filter:
      - checkout\b
    namespace: otel-demo
  - id: checkout-pod-1
    kind: Pod
    filter:
      - checkout-.*
    namespace: otel-demo
  - id: frontend-service-1
    kind: Service
    filter:
      - frontend\b
    namespace: otel-demo
  - id: frontend-pod-1
    kind: Pod
    filter:
      - frontend-.*
    namespace: otel-demo
  - id: frontend-proxy-service-1
    kind: Service
    filter:
      - frontend-proxy\b
    namespace: otel-demo
  - id: frontend-proxy-pod-1
    kind: Pod
    filter:
      - frontend-proxy-.*
    namespace: otel-demo
aliases:
  - - valkey-service-1
    - valkey-pod-1
  - - cart-service-1
    - cart-pod-1
  - - checkout-service-1
    - checkout-pod-1
  - - frontend-service-1
    - frontend-pod-1
  - - frontend-proxy-service-1
    - frontend-proxy-pod-1
propagations:
  - source: valkey-pod-1
    target: cart-service-1
    condition: Valkey storage full, unable to write new cart data
    effect: Cart service experiences write failures and errors when storing cart items
  - source: cart-service-1
    target: checkout-service-1
    condition: Checkout service receives errors when trying to access cart information
    effect: Checkout service experiences errors during cart operations
  - source: checkout-service-1
    target: frontend-service-1
    condition: Frontend receives errors from checkout service due to cart failures
    effect: Frontend service experiences errors during cart and checkout operations
  - source: frontend-service-1
    target: frontend-proxy-service-1
    condition: Frontend-proxy receives errors from frontend service due to cart/checkout failures
    effect: Frontend-proxy service experiences errors when proxying requests
recommended_actions:
  - solution:
      id: fix_storage_issue
      actions:
        - Identify and remove the storage-filler sidecar container from valkey-cart deployment
        - Delete the /data/filler file to free up disk space
        - Verify valkey-cart can successfully write data
        - Monitor disk usage to prevent future storage exhaustion
